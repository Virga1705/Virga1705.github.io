<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Naruto Senki</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f8f8;
      /* Mencegah seleksi teks */
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* Internet Explorer/Edge */
      user-select: none;         /* Standard */
      /* Mencegah menu konteks (klik kanan) secara global */
      -webkit-touch-callout: none; /* Untuk iOS, mencegah menu pop-up saat long-press */
    }

    header {
      background: white;
      padding: 16px;
      font-size: 22px;
      font-weight: bold;
      text-align: left;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 999;
      display: flex;
      align-items: center;
      /* Tambahkan properti user-select untuk header juga */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .back-button {
      margin-right: 10px;
      padding: 0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all .2s ease-in-out;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      background: white;
      /* Mencegah seleksi teks dan klik kanan pada back button */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      outline: none;
    }

    .back-button:hover {
      background: #e0e0e0;
    }
    .back-button:focus {
        outline: none;
    }

    .back-button img {
      display: block;
      width: 26px;
      height: 26px;
      /* Mencegah draggable dan klik kanan pada gambar */
      pointer-events: none;
    }

    .card {
      margin: 30px auto;
      margin-left: 20px;
      margin-right: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      max-width: 360px;
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out, border-color 0.3s ease, box-shadow 0.3s ease; /* Added transitions for highlight */
      /* Mencegah seleksi teks dan klik kanan pada card */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      outline: none;
    }
    .card:focus {
        outline: none;
    }

    .card.zoom-in {
      opacity: 1;
      transform: scale(1);
    }

    .card a img {
      width: 100%;
      display: block;
      cursor: pointer;
      /* Mencegah draggable dan klik kanan pada gambar */
      pointer-events: none;
    }

    .title {
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      text-align: left;
      border-top: 1px solid #eee;
      display: flex;
      flex-direction: column;
    }

    /* New style for title-header */
    .title-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 8px; /* Space between title line and description toggle */
    }

    .title-header span {
        flex-grow: 1; /* Allow title text to take available space */
        font-size: 16px; /* Ensure title size is consistent */
        font-weight: bold; /* Ensure title weight is consistent */
        padding-right: 10px; /* Space between title and share button */
    }

    .desc-toggle {
      margin-top: 0;
      background: none;
      border: none;
      color: #007BFF;
      cursor: pointer;
      font-size: 14px;
      padding: 0;
      text-align: left;
      outline: none;
    }
    .desc-toggle:focus {
        outline: none;
    }

    .desc-text {
      display: none;
      margin-top: 8px;
      font-weight: normal;
      font-size: 14px;
      color: #333;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      gap: 10px;
    }

    .buttons button {
      flex: 1;
      text-align: center;
      padding: 10px;
      border: 2px solid black;
      border-radius: 10px;
      font-weight: bold;
      color: black;
      background: white;
      cursor: pointer;
      transition: all .2s ease-in-out;
      /* Mencegah seleksi teks dan klik kanan pada tombol */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      outline: none;
    }
    .buttons button:focus {
        outline: none;
    }

    .buttons button:hover {
      background: black;
      color: white;
    }

    footer {
      text-align: center;
      margin-top: 50px;
      padding: 10px;
      color: #555;
      font-size: 14px;
      /* Mencegah seleksi teks pada footer */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      /* Mencegah seleksi teks dan klik kanan pada modal overlay */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .modal {
      background: white;
      border-radius: 12px;
      padding: 20px;
      width: 80%;
      max-width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      text-align: center;
      position: relative;
      /* Mencegah seleksi teks dan klik kanan pada modal */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }

    .modal-buttons a {
      text-decoration: none;
      padding: 10px;
      border: 2px solid black;
      border-radius: 10px;
      font-weight: bold;
      color: black;
      background: white;
      transition: all .2s ease-in-out;
      /* Mencegah seleksi teks dan klik kanan pada tombol modal */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .modal-buttons a:hover {
      background: black;
      color: white;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background: #ff5c5c;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      /* Mencegah seleksi teks dan klik kanan pada tombol tutup */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      outline: none;
    }
    .close-btn:focus {
        outline: none;
    }

    .close-btn:hover {
      background: #e04444;
    }

    /* SHARE BUTTON STYLES (UPDATED FOR NEW POSITION) */
    .share-button-container {
      cursor: pointer;
      z-index: 5;
      transition: transform 0.2s ease-in-out;
      outline: none;
      margin-left: auto; /* Push to the right */
    }

    .share-button-container:hover {
        transform: scale(1.1);
    }

    .share-button-container:focus {
        outline: none;
    }

    .share-button-container img {
      width: 24px;
      height: 24px;
      filter: grayscale(100%) brightness(1.5); /* Default icon style */
      transition: filter 0.3s ease-in-out;
    }

    /* Blinking effect for share icon */
    .share-button-container.blink img {
        filter: brightness(0) invert(1) sepia(1) saturate(5000%) hue-rotate(200deg); /* Change to a distinct color, e.g., blue */
    }

    /* Tooltip / Notification for "Copied!" */
    .share-tooltip {
        position: absolute; /* Relative to .share-button-container */
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out;
    }

    .share-tooltip.show {
        opacity: 1;
    }

    /* ADDED BACK: ANIMATION FOR CARD HIGHLIGHT */
    @keyframes card-highlight-blink {
        0%, 100% {
            border-color: #ccc; /* Default border color for .card */
            box-shadow: 0 2px 6px rgba(0,0,0,0.1); /* Default shadow for .card */
        }
        50% {
            border-color: #007bff; /* Blue color when blinking */
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); /* Blue shadow when blinking */
        }
    }

    .card.highlight-blink {
        animation: card-highlight-blink 1s ease-in-out 3; /* Blink 3 times */
    }


    /* NEW SHARE MODAL STYLES */
    #shareModal {
      display: none;
      position: fixed;
      z-index: 1003;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    #shareModal .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 25px;
      border-radius: 12px;
      width: 85%;
      max-width: 350px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
      text-align: center;
      animation: zoomIn 0.3s ease-out;
    }

    #shareModal .modal-content h3 {
        margin-top: 0;
        color: #333;
        font-size: 1.3rem;
        margin-bottom: 20px;
    }

    .share-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
    }

    .share-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: #555;
        font-size: 0.85rem;
        transition: transform 0.2s ease-in-out, color 0.2s ease;
    }

    .share-option:hover {
        transform: translateY(-3px);
        color: #007bff;
    }

    .share-option img {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: box-shadow 0.2s ease;
    }

    .share-option:hover img {
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* Specific colors for icons if needed */
    .share-option.whatsapp img { background-color: #25D366; }
    .share-option.telegram img { background-color: #0088CC; }
    .share-option.copy-link img { background-color: #6c757d; }

    #shareModal .close-btn-share {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        background: #ff5c5c;
        color: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s ease-in-out;
        outline: none;
    }
    #shareModal .close-btn-share:focus {
        outline: none;
    }
    #shareModal .close-btn-share:hover {
        background: #e04444;
    }

    @keyframes zoomIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body oncontextmenu="return false;">

  <header>
    <a href="Virga1705.github.io" class="back-button">
      <img src="https://files.catbox.moe/g9z1ny.png" alt="Kembali ke Beranda" draggable="false">
    </a>
    Naruto Senki
  </header>

  <div class="card" id="card-waifu-war-v1" data-share-id="waifu-war-v1">
    <a href="https://youtu.be/1NVlvJIrFPY?si=Cv-ta_itqLGUVg2D" target="_blank">
      <img src="https://files.catbox.moe/ml9alc.jpg" alt="Review Gameplay" draggable="false">
    </a>
    <div class="title">
      <div class="title-header">
        <span>NS: Waifu War V1</span>
        <div class="share-button-container" onclick="openShareOptionsModal('NS: Waifu War V1', 'card-waifu-war-v1', this); event.preventDefault();">
            <img src="https://files.catbox.moe/40ynkg.png" alt="Share" draggable="false">
            <span class="share-tooltip">Copied!</span>
        </div>
      </div>
      <button class="desc-toggle" onclick="toggleDesc(this)">Deskripsi ▼</button>
      <div class="desc-text" style="display:none; margin-top:8px; font-weight:normal; font-size:14px; color:#333;">
        Versi yang menampilkan karakter waifu dari Naruto. Cocok bagi fans karakter cewek dan mod anime.
      </div>
    </div>
    <div class="buttons">
      <button onclick="openModal('download', 'waifu1', 'Download Link1', 'Download Link2')">Download</button>
      <button onclick="openModal('howto', 'waifu1', '', '')">Cara Download</button>
    </div>
  </div>

  <div class="card" id="card-narsen-unprotect" data-share-id="narsen-unprotect">
    <a href="https://youtu.be/mRTvlyhyzuk" target="_blank"><img src="https://files.catbox.moe/deyydz.jpg" alt="NS Original" draggable="false"></a>
    <div class="title">
      <div class="title-header">
        <span>Narsen Unprotect 1.17 Full Screen</span>
        <div class="share-button-container" onclick="openShareOptionsModal('Narsen Unprotect 1.17', 'card-narsen-unprotect', this); event.preventDefault();">
            <img src="https://files.catbox.moe/40ynkg.png" alt="Share" draggable="false">
            <span class="share-tooltip">Copied!</span>
        </div>
      </div>
      <button class="desc-toggle" onclick="toggleDesc(this)">Deskripsi ▼</button>
      <div class="desc-text" style="display:none; margin-top:8px; font-weight:normal; font-size:14px; color:#333;">
        Narsen Unprotect 1.17 adalah versi dasar dari Naruto Senki tanpa modifikasi Lain. Cocok untuk project narsen kalian.
      </div>
    </div>
    <div class="buttons">
      <button onclick="openModal('download', 'original', 'Download Link1', 'Download Link2')">Download</button>
      <button onclick="openModal('howto', 'original', '', '')">Cara Download</button>
    </div>
  </div>

  <div class="card" id="card-naruto-senki-216" data-share-id="naruto-senki-216">
    <a href="https://youtu.be/NCH1Ohn5okM" target="_blank"><img src="https://files.catbox.moe/zjidv3.jpg" alt="NS V2.1" draggable="false"></a>
    <div class="title">
      <div class="title-header">
        <span>NARUTO SENKI 2.1.6</span>
        <div class="share-button-container" onclick="openShareOptionsModal('NARUTO SENKI 2.1.6', 'card-naruto-senki-216', this); event.preventDefault();">
            <img src="https://files.catbox.moe/40ynkg.png" alt="Share" draggable="false">
            <span class="share-tooltip">Copied!</span>
        </div>
      </div>
      <button class="desc-toggle" onclick="toggleDesc(this)">Deskripsi ▼</button>
      <div class="desc-text" style="display:none; margin-top:8px; font-weight:normal; font-size:14px; color:#333;">
        Naruto Senki 2.1.6 adalah Narsen yang di Kembangkan Oleh RE Memberikan Update Dengan Mode Baru dan Balancing Gameplay.
      </div>
    </div>
    <div class="buttons">
      <button onclick="openModal('download', 'v21', 'Download Link1', 'Download Link2')">Download</button>
      <button onclick="openModal('howto', 'v21', '', '')">Cara Download</button>
    </div>
  </div>


  <footer>© 2025 вирга</footer>

  <div class="modal-overlay" id="popup">
    <div class="modal">
      <span class="close-btn" onclick="closeModal()">X</span> <div id="modal-body"></div>
    </div>
  </div>

  <div id="shareModal">
    <div class="modal-content">
      <span class="close-btn-share" onclick="closeShareModal()">X</span>
      <h3 id="shareModalTitle">Share this Card</h3>
      <div class="share-options">
        </div>
    </div>
  </div>

  <script>
    // Global variable to keep track of the currently highlighted card
    let currentHighlightedCard = null;

    function openModal(mode, gameVersion, buttonText1 = 'Download Apk sekarang', buttonText2 = 'Download APK Lainnya') {
      const popup = document.getElementById('popup');
      const body = document.getElementById('modal-body');
      let content = '';
      let downloadLink1 = '';
      let downloadLink2 = '';
      let youtubeLink1 = '';
      let youtubeLink2 = '';

      /* Untuk Stel Link */
      switch (gameVersion) {
        case 'waifu1':
          downloadLink1 = 'https://sfl.gl/JUucxpu';
          downloadLink2 = 'https://example.com/waifu1_another_download.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/waifu1_tutorial2';
          break;
        case 'original':
          downloadLink1 = 'https://link2unlock.com/d1e1c';
          downloadLink2 = 'https://example.com/original_another_download.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/original_tutorial2';
          break;
        case 'v21':
          downloadLink1 = 'https://sfl.gl/pqugi';
          downloadLink2 = 'https://github.com/Naruto-Senki/files/releases/download/v2.1.6-fix/NSV2_2.1.6-fix_Android.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/v21_tutorial2';
          break;
        case 'cina':
          downloadLink1 = 'https://example.com/cina_download.apk';
          downloadLink2 = 'https://example.com/cina_another_download.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/cina_tutorial2';
          break;
        case 'uchiha':
          downloadLink1 = 'https://example.com/uchiha_download.apk';
          downloadLink2 = 'https://example.com/uchiha_another_download.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/uchiha_tutorial2';
          break;
        default:
          downloadLink1 = 'https://example.com/default_download.apk';
          downloadLink2 = 'https://example.com/default_another_download.apk';
          youtubeLink1 = 'https://youtu.be/Af1Sj7MDhiM?si=EHKw02WB87uTumQI';
          youtubeLink2 = 'https://youtube.com/default_tutorial2';
      }

      body.innerHTML = content;
      popup.style.display = 'flex';
      closeShareModal(); // Close share modal if general modal opens
    }

    function closeModal() {
      document.getElementById('popup').style.display = 'none';
      // Ensure highlight is removed if modal closed without share
      if (currentHighlightedCard) {
          currentHighlightedCard.classList.remove('highlight-blink');
          currentHighlightedCard = null;
      }
    }

    // UPDATED: Event listeners for closing modals when clicking outside
    document.addEventListener('click', e => {
        const popupModal = document.getElementById('popup');
        const shareModal = document.getElementById('shareModal');

        // Close general modal (download/howto) if clicked outside its content
        if (popupModal.style.display === 'flex' && !popupModal.querySelector('.modal').contains(e.target)) {
            closeModal();
        }

        // Close share modal if clicked outside its content
        if (shareModal.style.display === 'flex' && !shareModal.querySelector('.modal-content').contains(e.target)) {
            closeShareModal();
        }
    });

    // ADDED: Prevent clicks inside modals from closing them by stopping propagation
    document.getElementById('popup').querySelector('.modal').addEventListener('click', e => {
        e.stopPropagation();
    });
    document.getElementById('shareModal').querySelector('.modal-content').addEventListener('click', e => {
        e.stopPropagation();
    });

    function toggleDesc(btn) {
      const desc = btn.nextElementSibling;
      const isVisible = desc.style.display === 'block';
      desc.style.display = isVisible ? 'none' : 'block';
      btn.textContent = isVisible ? 'Deskripsi ▼' : 'Tutup ▲';
    }

    function checkZoom() {
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        const cardTop = card.offsetTop;
        const windowBottom = window.scrollY + window.innerHeight;
        const windowTop = window.scrollY;
        const cardHeight = card.offsetHeight;
        const isVisible = (cardTop < windowBottom) && (cardTop + cardHeight > windowTop);

        if (isVisible) {
          card.classList.add('zoom-in');
        } else {
          card.classList.remove('zoom-in');
        }
      });
    }

    window.addEventListener('scroll', checkZoom);
    window.addEventListener('resize', checkZoom);
    window.addEventListener('load', checkZoom);

    // SHARE OPTIONS MODAL FUNCTIONS
    let currentShareLink = '';
    let currentShareTitle = '';
    let currentShareIconElement = null; // To store the icon element for blink effect

    function openShareOptionsModal(cardTitle, cardId, iconElement) {
        currentShareTitle = cardTitle;
        // Use full URL for sharing, assuming this page is also hosted
        currentShareLink = window.location.origin + window.location.pathname + '#' + cardId;
        currentShareIconElement = iconElement; // Store the icon element

        const shareModal = document.getElementById('shareModal');
        const shareModalTitle = document.getElementById('shareModalTitle');
        const shareOptionsContainer = shareModal.querySelector('.share-options');

        shareModalTitle.textContent = `Share "${cardTitle}"`;
        shareOptionsContainer.innerHTML = ''; // Clear previous options

        // Define share platforms
        const sharePlatforms = [
            { name: 'WhatsApp', icon: 'https://cdn-icons-png.flaticon.com/512/2111/2111644.png', url: `https://wa.me/?text=${encodeURIComponent(currentShareTitle + ' - ' + currentShareLink)}`, class: 'whatsapp' },
            { name: 'Telegram', icon: 'https://cdn-icons-png.flaticon.com/512/2111/2111646.png', url: `https://t.me/share/url?url=${encodeURIComponent(currentShareLink)}&text=${encodeURIComponent(currentShareTitle)}`, class: 'telegram' },
            { name: 'Facebook', icon: 'https://cdn-icons-png.flaticon.com/512/174/174848.png', url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentShareLink)}&quote=${encodeURIComponent(currentShareTitle)}` },
            { name: 'Twitter (X)', icon: 'https://cdn-icons-png.flaticon.com/512/5968/5968830.png', url: `https://twitter.com/intent/tweet?url=${encodeURIComponent(currentShareLink)}&text=${encodeURIComponent(currentShareTitle)}` },
            { name: 'Copy Link', icon: 'https://cdn-icons-png.flaticon.com/512/1000/1000957.png', action: 'copy', class: 'copy-link' }
        ];

        // Try Web Share API first
        if (navigator.share) {
            navigator.share({
                title: currentShareTitle,
                text: `Check out this card: ${currentShareTitle}`,
                url: currentShareLink
            }).then(() => {
                console.log('Successfully shared via Web Share API');
                if (currentShareIconElement) {
                    applyShareIconBlink(currentShareIconElement);
                    applyCardHighlightBlink(currentShareIconElement.closest('.card')); // Trigger card highlight
                }
            }).catch((error) => {
                console.error('Error sharing via Web Share API:', error);
                // If Web Share API fails or is cancelled, fall back to custom modal
                showCustomShareModal(shareOptionsContainer, sharePlatforms);
            });
        } else {
            // Fallback to custom share modal
            showCustomShareModal(shareOptionsContainer, sharePlatforms);
        }

        closeModal(); // Close any other open modals (like download/howto)
    }

    function showCustomShareModal(container, platforms) {
        platforms.forEach(platform => {
            const optionDiv = document.createElement('div');
            optionDiv.classList.add('share-option');
            if (platform.class) optionDiv.classList.add(platform.class);

            const img = document.createElement('img');
            img.src = platform.icon;
            img.alt = platform.name;
            img.draggable = false; // Prevent dragging

            const nameSpan = document.createElement('span');
            nameSpan.textContent = platform.name;

            optionDiv.appendChild(img);
            optionDiv.appendChild(nameSpan);

            optionDiv.addEventListener('click', () => {
                if (platform.action === 'copy') {
                    copyLinkToClipboard(currentShareLink, currentShareIconElement);
                    closeShareModal(); // Close modal after copying
                } else {
                    window.open(platform.url, '_blank');
                    closeShareModal(); // Close modal after opening share URL
                }
            });
            container.appendChild(optionDiv);
        });
        document.getElementById('shareModal').style.display = 'flex'; // Show the custom modal
    }


    function closeShareModal() {
      document.getElementById('shareModal').style.display = 'none';
      if (currentShareIconElement) { // If there was an icon element from the share click
          applyCardHighlightBlink(currentShareIconElement.closest('.card')); // Trigger card highlight
          applyShareIconBlink(currentShareIconElement); // Trigger icon blink as well
      }
      currentShareLink = '';
      currentShareTitle = '';
      currentShareIconElement = null; // Clear the stored element
    }

    // Function to apply blinking effect to share icon
    function applyShareIconBlink(iconContainer) {
        if (!iconContainer) return;

        iconContainer.classList.add('blink');
        const tooltip = iconContainer.querySelector('.share-tooltip');
        if (tooltip) {
            tooltip.classList.add('show');
        }

        setTimeout(() => {
            iconContainer.classList.remove('blink');
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        }, 1000); // Blink for 1 second and hide tooltip
    }

    // Function to apply blinking effect to the card itself
    function applyCardHighlightBlink(cardElement) {
        if (!cardElement) return;

        // Remove highlight from previously highlighted card, if any
        if (currentHighlightedCard && currentHighlightedCard !== cardElement) {
            currentHighlightedCard.classList.remove('highlight-blink');
        }

        cardElement.classList.add('highlight-blink');
        currentHighlightedCard = cardElement; // Set the current highlighted card

        // Remove the animation class after it completes
        setTimeout(() => {
            cardElement.classList.remove('highlight-blink');
            if (currentHighlightedCard === cardElement) { // Only reset if it's still the same card
                currentHighlightedCard = null;
            }
        }, 3000); // Duration matches animation: 3 blinks * 1s/blink = 3s
    }

    // Function to copy link to clipboard (used within the custom share modal)
    function copyLinkToClipboard(link, iconElement) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(link).then(() => {
                console.log('Link copied to clipboard:', link);
                applyShareIconBlink(iconElement); // Apply blink effect to the original share icon
                // Card highlight will be applied when closeShareModal is called
            }).catch(err => {
                console.error('Failed to copy link:', err);
                alert('Failed to copy link. Please copy it manually: ' + link);
            });
        } else {
            // Fallback for browsers that do not support navigator.clipboard
            const tempInput = document.createElement('textarea');
            tempInput.value = link;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Link copied to clipboard: ' + link);
            applyShareIconBlink(iconElement); // Apply blink effect to the original share icon
            // Card highlight will be applied when closeShareModal is called
        }
    }

    // ADDED: Function to handle direct link to a card (e.g., from a shared link)
    function scrollToCardFromHash() {
        if (window.location.hash) {
            const targetId = window.location.hash.substring(1); // Remove the '#'
            const targetElement = document.getElementById(targetId);

            if (targetElement) {
                // Add a small delay to ensure page layout is stable before scrolling and animating
                setTimeout(() => {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    applyCardHighlightBlink(targetElement); // Apply the blinking animation
                }, 500); // Delay scroll to ensure elements are rendered
            }
        }
    }

    window.addEventListener('load', scrollToCardFromHash);
    window.addEventListener('hashchange', scrollToCardFromHash); // Listen for changes in the URL hash
  </script>

  <script src="https://l2dwidget.js.org/lib/L2Dwidget.min.js"></script>
  <script>
    function getRandomMessage() {
      const messages = [
        'Tekan Tombol Cara Downloadnya Ya Jika Kamu Bingung',
        'Kalau Ada Masalah Link Yang Eror Silahkan Beri Tahu Tuan Ku Ya. Dan Sabar Menunggu Linknya Di Fix ;)',
        'Jangan Lupa Belangganan Channel Tuan Ku Ya :3',
        'Jangan Lupa Klik Gambarnya Untuk Melihat Gameplay nya~',
      ];
      const randomIndex = Math.floor(Math.random() * messages.length);
      return messages[randomIndex];
    }

    L2Dwidget.init({
      model: {
        jsonPath: "https://raw.githubusercontent.com/KanzakiisYU/live2d-model/main/kurumi/model.json"
      },
      display: {
        position: "right",
        width: 200,
        height: 550,
        hOffset: 20,
        vOffset: -200
      },
      mobile: {
        show: true,
        scale: 1
      },
      dialog: {
        enable: true,
        script: {
          'every idle 10s': getRandomMessage(),
          'tap body': 'Hentai!',
          'tap face': getRandomMessage()
        }
      }
    });
  </script>

</body>
</html>